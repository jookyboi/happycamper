/*
 * jLinq - 3.0.2 (minified)
 * Hugo Bonacci - hugoware.com
 * http://creativecommons.org/licenses/by/3.0/
 */
 
var jLinq;var jlinq;var jl;(function(){var p={command:{query:0,select:1,action:2},exp:{get_path:/\./g,escape_regex:/[\-\[\]\{\}\(\)\*\+\?\.\,\\\^\$\|\#\s]/g},type:{nothing:-1,undefined:0,string:1,number:2,array:3,regex:4,bool:5,method:6,datetime:7,object:99},library:{commands:{},types:{},addType:function(a,b){p.library.types[a]=b},extend:function(b){if(!p.util.isType(p.type.array,b)){b=[b]}p.util.each(b,function(a){p.library.commands[a.name]=a})},query:function(h,i){if(!p.util.isType(p.type.array,h)){throw"jLinq can only query arrays of objects.";}h=i.clone||(i.clone==null&&jLinq.alwaysClone)?p.util.clone(h):h;var j={instance:{ignoreCase:jLinq.ignoreCase,not:false,lastCommand:null,lastField:null,records:h,removed:[],or:function(){j.startNewCommandSet()},query:{}},canRepeatCommand:function(a){return j.instance.lastCommand!=null&&a.length==(j.instance.lastCommand.method.length+1)&&p.util.isType(p.type.string,a[0])},commands:[[]],execute:function(){var b=[];var c=j.instance;p.util.each(j.instance.records,function(a){c.record=a;if(j.evaluate(c)){b.push(a)}else{j.instance.removed.push(a)}});j.instance.records=b},findValue:p.util.findValue,evaluate:function(a){for(var b in j.commands){var c=j.commands[b];if(j.evaluateSet(c,a)){return true}};return false},evaluateSet:function(b,c){for(var d in b){var f=b[d];c.value=j.findValue(c.record,f.path);c.compare=function(a){return p.util.compare(c.value,a,c)};c.when=function(a){return p.util.when(c.value,a,c)};try{var g=f.method.apply(c,f.args);if(f.not){g=!g}if(!g){return false}}catch(e){return false}}return true},repeat:function(a){if(!j.instance.lastCommand||a==null){return}a=p.util.toArray(a);if(j.canRepeatCommand(a)){j.instance.lastField=a[0];a=p.util.select(a,null,1,null)}j.queue(j.instance.lastCommand,a)},queue:function(a,b){j.instance.lastCommand=a;var c={name:a.name,method:a.method,field:j.instance.lastField,count:a.method.length,args:b,not:j.not};if(c.args.length>a.method.length){c.field=c.args[0];c.args=p.util.remaining(c.args,1);j.instance.lastField=c.field}c.path=c.field;j.commands[j.commands.length-1].push(c);j.not=false},startNewCommandSet:function(){j.commands.push([])},setNot:function(){j.not=!j.not}};p.util.each(p.library.commands,function(d){if(d.type==p.command.query){var e=function(){j.queue(d,arguments);return j.instance.query};j.instance.query[d.name]=e;var f=p.util.operatorName(d.name);j.instance.query["or"+f]=function(){j.startNewCommandSet();return e.apply(null,arguments)};j.instance.query["orNot"+f]=function(){j.startNewCommandSet();j.setNot();return e.apply(null,arguments)};j.instance.query["and"+f]=function(){return e.apply(null,arguments)};j.instance.query["andNot"+f]=function(){j.setNot();return e.apply(null,arguments)};j.instance.query["not"+f]=function(){j.setNot();return e.apply(null,arguments)}}else if(d.type==p.command.select){j.instance.query[d.name]=function(){j.execute();var c=j.instance;c.compare=function(a,b){return p.util.compare(a,b,c)};c.when=function(a,b){return p.util.when(a,b,c)};return d.method.apply(c,arguments)}}else if(d.type==p.command.action){j.instance.query[d.name]=function(){var c=j.instance;c.compare=function(a,b){return p.util.compare(a,b,c)};c.when=function(a,b){return p.util.when(a,b,c)};d.method.apply(c,arguments);return j.instance.query}}});j.instance.query.or=function(){j.startNewCommandSet();j.repeat(arguments);return j.instance.query};j.instance.query.and=function(){j.repeat(arguments);return j.instance.query};j.instance.query.not=function(){j.setNot();j.repeat(arguments);return j.instance.query};j.instance.query.andNot=function(){j.setNot();j.repeat(arguments);return j.instance.query};j.instance.query.orNot=function(){j.startNewCommandSet();j.setNot();j.repeat(arguments);return j.instance.query};return j.instance.query}},util:{trim:function(a){a=a==null?"":a;a=a.toString();return a.replace(/^\s*|\s*$/g,"")},cloneArray:function(b){var c=[];p.util.each(b,function(a){c.push(p.util.clone(a))});return c},clone:function(a){if(p.util.isType(p.type.array,a)){return p.util.cloneArray(a)}else if(p.util.isType(p.type.object,a)){var b={};for(var c in a){b[c]=p.util.clone(a[c])}return b}else{return a}},invoke:function(a,b){b=b.concat();var c=b[0];var d=p.util.findValue(a,c);b=p.util.select(b,null,1,null);c=c.replace(/\..*$/,"");var f=p.util.findValue(a,c);a=f===d?a:f;try{var g=d.apply(a,b);return g}catch(e){return null}},getPath:function(a){return p.util.toString(a).split(p.exp.get_path)},findValue:function(a,b){if(p.util.isType(p.type.array,b)){return p.util.invoke(a,b)}else if(p.util.isType(p.type.string,b)){b=p.util.getPath(b);var c=0;while(a!=null&&c<b.length){a=a[b[c++]]}return a}else{return a}},elementAt:function(a,b){return a&&a.length>0&&b<a.length&&b>=0?a[b]:null},regexEscape:function(a){return(a?a:"").toString().replace(p.exp.escape_regex,"\\$&")},regexMatch:function(a,b,c){if(p.util.isType(p.type.regex,a)){a=a.source}a=new RegExp(p.util.toString(a),c?"gi":"g");return p.util.toString(b).match(a)!=null},operatorName:function(b){return b.replace(/^\w/,function(a){return a.toUpperCase()})},compare:function(a,b,c){var d=p.util.when(a,b,c);return d==true?d:false},when:function(a,b,c){var d=p.util.getType(a);for(var e in b){var f=p.type[e];if(f==d){return b[e].apply(c,[a])}}if(b.other){return b.other.apply(c,[a])}return null},each:function(a,b){var c=0;for(var d in a)b(a[d],c++)},grab:function(b,c){var d=[];p.util.each(b,function(a){d.push(c(a))});return d},until:function(a,b){var c=0;for(var d in a){var e=b(a[d],c++);if(e===true){return true}}return false},isType:function(a,b){return p.util.getType(b)==a},getType:function(a){if(a==null){return p.type.nothing}for(var b in p.library.types){if(p.library.types[b](a)){return b}}return p.type.object},remaining:function(a,b){var c=[];for(;b<a.length;b++)c.push(a[b]);return c},apply:function(a,b){for(var c in b){a[c]=b[c]}return a},reorder:function(a,b,c){return p.util._performSort(a,b,c)},_performSort:function(f,g,h){var i=g.splice(0,1);if(i.length==0){return f}i=i[0];var j=p.util.isType(p.type.array,i);var k=(j?i[0]:i);var l=k.match(/^\-/);k=l?k.substr(1):k;if(l){if(j){i[0]=k}else{i=k}}var m=function(c,d){var a=p.util.findValue(c,i);var b=p.util.findValue(d,i);if(a==null&&b==null){a=0;b=0}else if(a==null&&b!=null){a=0;b=1}else if(a!=null&&b==null){a=1;b=0}else if(h&&p.util.isType(p.type.string,a)&&p.util.isType(p.type.string,b)){a=a.toLowerCase();b=b.toLowerCase()}else if(a.length&&b.length){a=a.length;b=b.length}var e=(a<b)?-1:(a>b)?1:0;return l?-e:e};f.sort(m);if(g.length>0){var n=[];var o=p.util.group(f,i,h);p.util.each(o,function(a){var b=g.slice();var c=p.util._performSort(a,b,h);n=n.concat(c)});f=n}return f},group:function(a,b,c){var d={};for(var e in a){var f=a[e];var g=p.util.toString(p.util.findValue(f,b));g=c?g.toUpperCase():g;if(!d[g]){d[g]=[f]}else{d[g].push(f)}}return d},equals:function(a,b,c){return p.util.when(a,{string:function(){return p.util.regexMatch("^"+p.util.regexEscape(b)+"$",a,c)},other:function(){return(a==null&&b==null)||(a===b)}})},toArray:function(a){var b=[];if(a.length){for(var i=0;i<a.length;i++){b.push(a[i])}}else{for(var c in a){b.push(a[c])}}return b},toString:function(a){return a==null?"":a.toString()},skipTake:function(a,b,c,d){c=c==null?0:c;d=d==null?a.length:d;if(c>=a.length||d==0){return[]}return p.util.select(a,b,c,c+d)},select:function(d,e,f,g){f=f==null?0:f;g=g==null?d.length:g;var h=d.slice(f,g);if(jLinq.util.isType(jLinq.type.object,e)){var j=e;e=function(a){var b={};for(var c in j){b[c]=a[c]?a[c]:j[c]}return b}};if(jLinq.util.isType(jLinq.type.method,e)){for(var i=0;i<h.length;i++){var k=h[i];h[i]=e.apply(k,[k])}}return h}}};p.library.addType(p.type.nothing,function(a){return a==null});p.library.addType(p.type.array,function(a){return a instanceof Array});p.library.addType(p.type.string,function(a){return a.substr&&a.toLowerCase});p.library.addType(p.type.number,function(a){return a.toFixed&&a.toExponential});p.library.addType(p.type.regex,function(a){return a instanceof RegExp});p.library.addType(p.type.bool,function(a){return a==true||a==false});p.library.addType(p.type.method,function(a){return a instanceof Function});p.library.addType(p.type.datetime,function(a){return a instanceof Date});p.library.extend([{name:"ignoreCase",type:p.command.action,method:function(){this.ignoreCase=true}},{name:"reverse",type:p.command.action,method:function(){this.records.reverse()}},{name:"useCase",type:p.command.action,method:function(){this.ignoreCase=false}},{name:"each",type:p.command.action,method:function(b){jLinq.util.each(this.records,function(a){b(a)})}},{name:"attach",type:p.command.action,method:function(b,c){this.when(c,{method:function(){jLinq.util.each(this.records,function(a){a[b]=c(a)})},other:function(){jLinq.util.each(this.records,function(a){a[b]=c})}})}},{name:"join",type:p.command.action,method:function(b,c,d,e){jLinq.util.each(this.records,function(a){a[c]=jLinq.from(b).equals(e,a[d]).select()})}},{name:"assign",type:p.command.action,method:function(b,c,d,e,f){jLinq.util.each(this.records,function(a){a[c]=jLinq.from(b).equals(e,a[d]).first(f)})}},{name:"sort",type:p.command.action,method:function(){var a=jLinq.util.toArray(arguments);this.records=jLinq.util.reorder(this.records,a,this.ignoreCase)}},{name:"equals",type:p.command.query,method:function(a){return jLinq.util.equals(this.value,a,this.ignoreCase)}},{name:"starts",type:p.command.query,method:function(a){return this.compare({array:function(){return jLinq.util.equals(this.value[0],a,this.ignoreCase)},other:function(){return jLinq.util.regexMatch(("^"+jLinq.util.regexEscape(a)),this.value,this.ignoreCase)}})}},{name:"ends",type:p.command.query,method:function(a){return this.compare({array:function(){return jLinq.util.equals(this.value[this.value.length-1],a,this.ignoreCase)},other:function(){return jLinq.util.regexMatch((jLinq.util.regexEscape(a)+"$"),this.value,this.ignoreCase)}})}},{name:"contains",type:p.command.query,method:function(c){return this.compare({array:function(){var b=this.ignoreCase;return jLinq.util.until(this.value,function(a){return jLinq.util.equals(a,c,b)})},other:function(){return jLinq.util.regexMatch(jLinq.util.regexEscape(c),this.value,this.ignoreCase)}})}},{name:"match",type:p.command.query,method:function(c){return this.compare({array:function(){var b=this.ignoreCase;return jLinq.util.until(this.value,function(a){return jLinq.util.regexMatch(c,a,b)})},other:function(){return jLinq.util.regexMatch(c,this.value,this.ignoreCase)}})}},{name:"type",type:p.command.query,method:function(a){return jLinq.util.isType(a,this.value)}},{name:"greater",type:p.command.query,method:function(a){return this.compare({array:function(){return this.value.length>a},string:function(){return this.value.length>a},other:function(){return this.value>a}})}},{name:"greaterEquals",type:p.command.query,method:function(a){return this.compare({array:function(){return this.value.length>=a},string:function(){return this.value.length>=a},other:function(){return this.value>=a}})}},{name:"less",type:p.command.query,method:function(a){return this.compare({array:function(){return this.value.length<a},string:function(){return this.value.length<a},other:function(){return this.value<a}})}},{name:"lessEquals",type:p.command.query,method:function(a){return this.compare({array:function(){return this.value.length<=a},string:function(){return this.value.length<=a},other:function(){return this.value<=a}})}},{name:"between",type:p.command.query,method:function(a,b){return this.compare({array:function(){return this.value.length>a&&this.value.length<b},string:function(){return this.value.length>a&&this.value.length<b},other:function(){return this.value>a&&this.value<b}})}},{name:"betweenEquals",type:p.command.query,method:function(a,b){return this.compare({array:function(){return this.value.length>=a&&this.value.length<=b},string:function(){return this.value.length>=a&&this.value.length<=b},other:function(){return this.value>=a&&this.value<=b}})}},{name:"empty",type:p.command.query,method:function(){return this.compare({array:function(){return this.value.length==0},string:function(){return jLinq.util.trim(this.value).length==0},other:function(){return this.value==null}})}},{name:"is",type:p.command.query,method:function(){return this.compare({bool:function(){return this.value===true},other:function(){return this.value!=null}})}},{name:"min",type:p.command.select,method:function(a){var b=jLinq.util.reorder(this.records,[a],this.ignoreCase);return jLinq.util.elementAt(b,0)}},{name:"max",type:p.command.select,method:function(a){var b=jLinq.util.reorder(this.records,[a],this.ignoreCase);return jLinq.util.elementAt(b,b.length-1)}},{name:"sum",type:p.command.select,method:function(c){var d;jLinq.util.each(this.records,function(a){var b=jLinq.util.findValue(a,c);d=d==null?b:(d+b)});return d}},{name:"average",type:p.command.select,method:function(c){var d;jLinq.util.each(this.records,function(a){var b=jLinq.util.findValue(a,c);d=d==null?b:(d+b)});return d/this.records.length}},{name:"skip",type:p.command.select,method:function(a,b){this.records=this.when(b,{method:function(){return jLinq.util.skipTake(this.records,b,a,null)},object:function(){return jLinq.util.skipTake(this.records,b,a,null)},other:function(){return jLinq.util.skipTake(this.records,null,a,null)}});return this.query}},{name:"take",type:p.command.select,method:function(a,b){return this.when(b,{method:function(){return jLinq.util.skipTake(this.records,b,null,a)},object:function(){return jLinq.util.skipTake(this.records,b,null,a)},other:function(){return jLinq.util.skipTake(this.records,null,null,a)}})}},{name:"skipTake",type:p.command.select,method:function(a,b,c){return this.when(c,{method:function(){return jLinq.util.skipTake(this.records,c,a,b)},object:function(){return jLinq.util.skipTake(this.records,c,a,b)},other:function(){return jLinq.util.skipTake(this.records,null,a,b)}})}},{name:"select",type:p.command.select,method:function(a){return this.when(a,{method:function(){return jLinq.util.select(this.records,a)},object:function(){return jLinq.util.select(this.records,a)},other:function(){return this.records}})}},{name:"distinct",type:p.command.select,method:function(b){var c=jLinq.util.group(this.records,b,this.ignoreCase);return jLinq.util.grab(c,function(a){return jLinq.util.findValue(a[0],b)})}},{name:"group",type:p.command.select,method:function(a){return jLinq.util.group(this.records,a,this.ignoreCase)}},{name:"define",type:p.command.select,method:function(a){var b=this.when(a,{method:function(){return jLinq.util.select(this.records,a)},object:function(){return jLinq.util.select(this.records,a)},other:function(){return this.records}});return jLinq.from(b)}},{name:"any",type:p.command.select,method:function(){return this.records.length>0}},{name:"none",type:p.command.select,method:function(){return this.records.length==0}},{name:"all",type:p.command.select,method:function(){return this.removed.length==0}},{name:"first",type:p.command.select,method:function(a){var b=jLinq.util.elementAt(this.records,0);return b==null?a:b}},{name:"last",type:p.command.select,method:function(a){var b=jLinq.util.elementAt(this.records,this.records.length-1);return b==null?a:b}},{name:"at",type:p.command.select,method:function(a,b){var c=jLinq.util.elementAt(this.records,a);return c==null?b:c}},{name:"count",type:p.command.select,method:function(){return this.records.length}},{name:"removed",type:p.command.select,method:function(a){return this.when(a,{method:function(){return jLinq.util.select(this.removed,a)},object:function(){return jLinq.util.select(this.removed,a)},other:function(){return this.removed}})}},{name:"where",type:p.command.select,method:function(b){var c=this;var d=[];jLinq.util.each(this.records,function(a){if(b.apply(c,[a])===true){d.push(a)}});var e=jLinq.from(d);if(!this.ignoreCase){e.useCase()}return e}}]);jLinq={alwaysClone:false,ignoreCase:true,command:p.command,type:p.type,extend:function(){p.library.extend.apply(null,arguments)},query:function(a,b){return library.framework.query(a,b)},from:function(a){return p.library.query(a,{clone:false})},getCommands:function(){return p.util.grab(p.library.commands,function(a){return{name:a.name,typeId:a.type,type:a.type==p.command.select?"select":a.type==p.command.query?"query":a.type==p.command.action?"action":"unknown"}})},util:{trim:p.util.trim,findValue:p.util.findValue,elementAt:p.util.elementAt,regexEscape:p.util.regexEscape,regexMatch:p.util.regexMatch,equals:p.util.equals,group:p.util.group,reorder:p.util.reorder,when:p.util.when,toArray:p.util.toArray,each:p.util.each,grab:p.util.grab,until:p.util.until,isType:p.util.isType,getType:p.util.getType,apply:p.util.apply,select:p.util.select,skipTake:p.util.skipTake}};jlinq=jLinq;jl=jLinq})();